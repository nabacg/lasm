name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-validation:
    name: Validate PR (Java ${{ matrix.java-version }})
    runs-on: ubuntu-latest
    strategy:
      matrix:
        java-version: ['17', '21']

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Need full history for comparison

    - name: Check for syntax issues
      run: |
        echo "Checking for common issues..."

        # Check that examples directory exists
        if [ ! -d "examples" ]; then
          echo "❌ examples directory missing"
          exit 1
        fi

        echo "✓ Examples directory exists"

    - name: Install Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: ${{ matrix.java-version }}

    - name: Install Clojure
      uses: DeLaGuardo/setup-clojure@12.5
      with:
        cli: 1.12.0.1530

    - name: Quick syntax check
      run: |
        clojure -M -e "
        (require '[lasm.parser :as p])
        (println \"Testing parser loads...\")
        (println \"✓ Parser ready\")
        "

    - name: Check example files
      run: |
        echo "Checking all .lasm files..."
        for file in examples/*.lasm; do
          if [ -f "$file" ]; then
            echo "Checking $file"
            # Just check file exists and is readable
            cat "$file" > /dev/null || exit 1
          fi
        done
        echo "✓ All example files are readable"
